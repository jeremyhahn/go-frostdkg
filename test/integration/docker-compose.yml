version: '3.8'

services:
  # Integration test runner
  integration-tests:
    build:
      context: ../..
      dockerfile: test/integration/Dockerfile
    container_name: frostdkg-integration-tests
    environment:
      - CGO_ENABLED=1
      - GOOS=linux
      - GOARCH=amd64
      - GO_TEST_TIMEOUT=300s
    volumes:
      # Mount source code for development
      - ../../:/app
      # Cache go modules
      - go-mod-cache:/go/pkg/mod
      # Cache build cache
      - go-build-cache:/root/.cache/go-build
    working_dir: /app
    command: ["make", "integration-test-internal"]
    networks:
      - frostdkg-test-network

  # Optional: Add a health check service if needed for future distributed tests
  # Currently not needed as frostdkg tests are self-contained

volumes:
  go-mod-cache:
  go-build-cache:

networks:
  frostdkg-test-network:
    driver: bridge
